@model IEnumerable<Models.Schedule>
@{
    byte? count_rings = 4;
    if (Model!=null)
    {
        count_rings = Model.Max(p => p.order_ring);
    }


}
<!--Barname Haftegi-->
@{
    ViewBag.Title = "Schedule";
    Layout = "~/Views/Shared/Layout/_SiteManager.cshtml";
}

@using (@Html.BeginForm("InsertSchedule", "Classes", FormMethod.Post))
{
<!--Create Page Here and Footer-->
<div id="main-body" class="col-md-10 col-sm-10 col-xs-10 valign-top display-table-row">

    <div id="content">
        <header>
            <h4 class="choosed-class-name"><i class="fas fa-th"></i>&nbsp;ویرایش برنامه هفتگی</h4>
            <hr class="line-under-title" />
            
            <!--Breadcrumb-->
            <ol class="breadcrumb">
                <li><a href="classes.html">نام مرکز آموزشی</a></li>
                <li><a href="class-info.html">نام کلاس</a></li>
                <li><a href="class-hozor-qiab.html">ویرایش برنامه هفتگی</a></li>
            </ol>
        </header>

        
        
        <!--Alert Msg-->
        <div class="alert alert-success fade in hidden">
            <a href="#" class="close pull-left" data-dismiss="alert" aria-label="close">&times;</a>
            با موفقیت ثبت گردید!
        </div>

        <div class="alert alert-danger fade in hidden">
            <a href="#" class="close pull-left" data-dismiss="alert" aria-label="close">&times;</a>
            خطا در ثبت اطلاعات
        </div>

        <div class="alert alert-warning fade in hidden">
            <a href="#" class="close pull-left" data-dismiss="alert" aria-label="close">&times;</a>
            ارتباط با سرور قطع شده است!
        </div>

        <!--Add Table Row-->
        <div class="row">
            <div class="col-md-12">
                <div class="class-action-btn pull-left">
                    <a id="btn_addcol" class="btn btn-md btn-default" href="#" data-toggle="modal" data-target="#mymodal" role="button">
                        <span class="fas fa-plus-circle" aria-hidden="true"></span>&nbsp;&nbsp;اضافه کردن ستون
                    </a>

                    <a id="btn_DelCol" class="btn btn-md btn-danger" href="#" data-toggle="modal" data-target="#mymodal" role="button">
                        <span class="fas fa-minus-circle" aria-hidden="true"></span>&nbsp;&nbsp;کم کردن ستون
                    </a>

                </div>
            </div><!--End Add Student-->
        </div>

        <hr class="line-under-title" />
        <!--Top Note-->
        <div class="content-inner">

        @{
            List<ViewModel.IdNameVM> courselist =(List<ViewModel.IdNameVM>) ViewBag.courselist;
            List<ViewModel.IdNameVM> weekday = (List<ViewModel.IdNameVM>)ViewBag.weekday;
            List<ViewModel.Username_FN_LNVM> teacherlist = (List<ViewModel.Username_FN_LNVM>) ViewBag.teacherlist;
            }
            <div class="table-responsive">
                <table class="table table-striped table-bordered" id="table-barname-list-eidt">
                    <thead>
                        <tr>
                            <th data-col="0" class="text-center th-rooz">روز</th>

                            @for (byte i = 1; i <= count_rings; i++)
                            {
                                <th data-col="@i" class="text-center th-zang-x">
                                    <span name="ring@i">زنگ @i</span>

                                </th>
                            }

                        </tr>
                    </thead>
                    <tbody>
                        <tr data-row="0">
                            <td data-row="0" data-col="0" class="text-center td-barname-edit-roz">
                                <select name="orderweek">
                                    <option value="0"> انتخاب کنید ... </option>
                                    @foreach (var item in weekday)
                                    {
                                        if (ViewBag.currentday != null)
                                        {
                                            if (item.id == (int)ViewBag.currentday)
                                            {
                                                <option selected value="@item.id"> @item.name </option>
                                            }
                                            else
                                            {
                                                <option value="@item.id"> @item.name </option>
                                            }
                                        }
                                        else
                                        {
                                            <option value="@item.id"> @item.name </option>
                                        }

                                    }
                                </select>
                            </td>
                            
                            @* ----- For Count Ring Must Create <td/> *@
                            @for (byte i = 1; i <= count_rings; i++)
                            {
                                <td data-row="0" data-col="@i" class="text-center td-barname-info">

                                    @{ bool ismodelring = false;}

                                    @if(Model!=null)
                                    {
                                        var ring_schedule = Model.Where(p => p.order_ring == i).FirstOrDefault();
                                        if(ring_schedule!=null)
                                        {
                                            ismodelring = true;

                                            <!--Show element from model scedule-->
                                            <input name="schedule_@i" value="@ring_schedule.id" type="hidden" />
                                            <!-- Course 1 -->
                                            <div class="custome-select">
                                                <span>نام درس اول : </span>
                                                <select name="course1_@i">
                                                    <option value="0"> انتخاب کنید ... </option>
                                                    @foreach (var item in courselist)
                                                    {
                                                        if (item.id == ring_schedule.Courseid_one)
                                                        {
                                                            <option selected value="@item.id">@item.name</option>
                                                        }
                                                        else
                                                        {

                                                    <option value="@item.id">@item.name</option> 
                                                        }

                                                    }
                                                </select>
                                            </div>
                                    <!--end Course 1-->
                                            <!--Teacher 1-->
                                            <div class="custome-select">
                                                <span>نام مدرس اول  : </span>
                                                <select name="teacher1_@i">
                                                    <option value="0"> انتخاب کنید ... </option>
                                                    @foreach (var item in teacherlist)
                                                    {
                                                        if (item.username == ring_schedule.Teacher_one)
                                                        {
                                                            <option selected value="@item.username">@item.firstname @item.lastname</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@item.username">@item.firstname @item.lastname</option>
                                                        }

                                                    }
                                                </select>
                                            </div>
                                    <!--end teacher1-->
                                            <hr>
                                            <!-- Course 2 -->
                                            string mystyle = "display:none;";
                                            if(ring_schedule.Type_Ring!=0)
                                            {
                                                mystyle = "";
                                            }
                                            <div id="course2_@i" class="custome-select" style="@mystyle">
                                                <span>نام درس دوم : </span>
                                                <select name="course2_@i">
                                                    <option value="0"> انتخاب کنید ... </option>
                                                    @foreach (var item in courselist)
                                                    {
                                                        if (item.id == ring_schedule.Courseid_two)
                                                        {
                                                            <option selected value="@item.id">@item.name</option>
                                                        }
                                                        else
                                                        {

                                                            <option value="@item.id">@item.name</option>
                                                        }

                                                    }
                                                </select>
                                            </div>
                                    <!--end Course 2-->
                                            <!--Teacher 2-->
                                            <div id="teacher2_@i" class="custome-select" style="@mystyle">
                                                <span>نام مدرس دوم  : </span>
                                                <select name="teacher2_@i">
                                                    <option value="0"> انتخاب کنید ... </option>
                                                    @foreach (var item in teacherlist)
                                                    {
                                                        if (item.username == ring_schedule.Teacher_two)
                                                        {
                                                            <option selected value="@item.username">@item.firstname @item.lastname</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@item.username">@item.firstname @item.lastname</option>
                                                        }

                                                    }
                                                </select>
                                            </div>
                                    <!--end teacher2-->
                                            <hr>
                                            <!-- Info Zang -->
                                            <div class="custome-select">
                                                <span>نوع زنگ : </span>
                                                <select name="ringtype_@i" class="info_ring" data-bind="@i">
                                                    @if (ring_schedule.Type_Ring == 0)
                                                    {
                                                    <option selected value="0">کامل</option>}
                                                    else
                                                    {
                                                    <option value="0">کامل</option> }

                                                    @if (ring_schedule.Type_Ring == 1)
                                                    {
                                                        <option selected value="1">چرخشی</option>}
                                                    else
                                                    {
                                                        <option value="1">چرخشی</option> }

                                                    @if (ring_schedule.Type_Ring == 2)
                                                    {
                                                        <option selected value="2">تک زنگ</option>}
                                                    else
                                                    {
                                                        <option value="2">تک زنگ</option> }

                                                    
                                                </select>
                                            </div>
                                            <hr>
                                            <!--End Info Zang -->
                                            <hr>
                                            <div class="custome-select">
                                                @{ 
                                                    string startdate= ((DateTime)ring_schedule.start_time).ToString("hh: mm tt", System.Globalization.CultureInfo.InvariantCulture);
                                                    string enddate= ((DateTime)ring_schedule.end_time).ToString("hh: mm tt", System.Globalization.CultureInfo.InvariantCulture);
                                                    startdate= startdate.Replace("AM", "ق ظ").Replace("PM", "ب ظ");
                                                    enddate= enddate.Replace("AM", "ق ظ").Replace("PM", "ب ظ");
                                                }
                                                
                                                <input name="startdate_@i" type="text" value="@startdate" class="observer-example date-picker">
                                                الی
                                                <input name="enddate_@i" value="@enddate" type="text" class="observer-example date-picker">

                                            </div>
                                            <!--End Show element from model scedule-->

                                        }
                                    }
                                    









                                    @if (ismodelring == false)
                                    {


                                        <input name="schedule_@i" value="0" type="hidden" />
                                    <!-- Course 1 -->
                                    <div class="custome-select">
                                        <span>نام درس اول : </span>
                                        <select name="course1_@i">
                                            <option selected value="0"> انتخاب کنید ... </option>
                                            @foreach (var item in courselist)
                                            {
                                                <option value="@item.id">@item.name</option>
                                            }
                                        </select>
                                    </div>
                                    <!--end Course 1-->

                                    <!--Teacher 1-->
                                    <div class="custome-select">
                                        <span>نام مدرس اول  : </span>
                                        <select name="teacher1_@i">
                                            <option selected value="0"> انتخاب کنید ... </option>
                                            @foreach (var item in teacherlist)
                                            {
                                                <option value="@item.username">@item.firstname @item.lastname</option>
                                            }
                                        </select>
                                    </div>
                                    <!--end teacher1-->
                                    <hr>
                                    <!-- Course 2 -->
                                    <div id="course2_@i" class="custome-select" style="display:none;">
                                        <span>نام درس دوم : </span>
                                        <select name="course2_@i">
                                            <option selected value="0"> انتخاب کنید ... </option>
                                            @foreach (var item in courselist)
                                            {
                                                <option value="@item.id">@item.name</option>
                                            }
                                        </select>
                                    </div>
                                    <!--end Course 2-->
                                    <!--Teacher 2-->
                                    <div id="teacher2_@i" class="custome-select" style="display:none;">
                                        <span>نام مدرس دوم  : </span>
                                        <select name="teacher2_@i">
                                            <option selected value="0"> انتخاب کنید ... </option>
                                            @foreach (var item in teacherlist)
                                            {
                                                <option value="@item.username">@item.firstname @item.lastname</option>
                                            }
                                        </select>
                                    </div>
                                    <!--end teacher2-->
                                    <hr>
                                    <!-- Info Zang -->
                                    <div class="custome-select">
                                        <span>نوع زنگ : </span>
                                        <select name="ringtype_@i" class="info_ring" data-bind="@i">
                                            <option value="0">کامل</option>
                                            <option value="1">چرخشی</option>
                                            <option value="2">تک زنگ</option>
                                        </select>
                                    </div>
                                    <hr>
                                    <hr>
                                    <div class="custome-select">
                                        <input name="startdate_@i" type="text" class="observer-example date-picker">
                                        الی
                                        <input name="enddate_@i" type="text" class="observer-example date-picker">

                                    </div>


                                    }
</td>
                            }
                                    @* ----- End For Count Ring Must Create <td/> *@



                        </tr>

                        

                    </tbody>
                </table>
            </div>

            <div class="text-center" id="ok-or-not">

                <button type="submit" name="Submit" class="btn btn-sm btn-default" >
                    <span class="fas fa-check-circle" aria-hidden="true"></span>&nbsp;ثبت تغییرات
                </button>
                
                
                <a class="btn btn-sm btn-danger" href="@Url.Action("CancelSchedule","Classes",null)" role="button">
                    <span class="fas fa-times-circle" aria-hidden="true"></span>&nbsp;انصراف
                </a>

            </div>
            <input id="countcol" name="countcol" type="hidden" value="@count_rings.ToString()" />
            <input id="EC" name="countcol" type="hidden" value="@ViewBag.EC" />
        </div><!--End Content-inner-->

        <hr class="line-under-title" />

        <div id="tbl_scheduleview" class="table-responsive">
            
        </div>

        <hr class="line-under-title" />

        
    </div>
    <!-- Modal For Delete Student -->
    <div class="modal fade" id="modal-delete" role="dialog">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <!--
                 <div class="modal-header">
                 </div> -->
                <div class="modal-body text-center">
                    <h4>آیا مایل به حذف هستید؟</h4>
                </div>
                <div class="modal-footer text-center">
                    <div class="col-md-6">
                        <button type="button" class="btn btn-default" data-dismiss="modal">خیر</button>
                    </div>
                    <div class="col-md-6">
                        <button id="btn_deleteschedule" type="button" class="btn btn-danger" data-send="modal">بله</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!--Footer
    <div class="row">
        <footer id="admin-footer" class="clearfix">
            <div class="pull-right"><b>کپی رایت</b>&copy;۲۰۱۸</div>
            <div class="pull-right">پیوندیار سیستم</div>
        </footer>
    </div> -->
</div>
<!--End Page Body-->
}




@section Styles {
    @Styles.Render("~/Content/dashboard/persian-datepicker.css")
    }


@section Scripts{
    @Scripts.Render("~/Scripts/dashboard/persian-calender/persian-datepicker.js")
    @Scripts.Render("~/Scripts/dashboard/persian-calender/persian-date.js")
    <script>
        
        $(document).on('click', '.observer-example', function() {
            var i=0;
            $(this).persianDatepicker({
                observer: true,
                format: 'HH:mm a',
                altField: '.observer-example-alt',
                onlyTimePicker : true,
                autoClose : true,
                format : "HH:m a",
                viewMode : "day",
                initialValue : false,

                timePicker: {
                    enabled: true,
                    step: '1',
                    hour: {
                        enabled: true,
                        step: null
                    },
                    minute: {
                        enabled: true,
                        step: null
                    },

                    second: {
                        enabled: false,
                        step: null
                    }
                }
            });
        });

        $(document).on('change', '.info_ring', function() {
            var div_course="#course2_"+$(this).data().bind;
            var div_teacher="#teacher2_"+$(this).data().bind;
            if($(this).val()==1 || $(this).val()==2)
            {
                $(div_course).css("display","block");
                $(div_teacher).css("display","block");
            }
            else{
                $(div_course).css("display","none");
                $(div_teacher).css("display","none");
            }
        });    
</script>
    
    
<script>
    $(document).ready(function (ev) {

        var colcount =parseInt(parseInt($("#countcol").val())+1);

        $("#btn_addcol").click(function () {
            //debugger
            AddNewHead(colcount);

            AddNewCol(colcount);

            colcount = colcount + 1;
            $("#countcol").val(colcount -1);

        });


        $("#btn_DelCol").click(function(){

            myTable_DelCol(colcount-1);
            colcount = colcount - 1;
            $("#countcol").val(colcount -1);
        });


        LoadBarnameHaftegi();


        var scheduleDelorder_week;

        $(document).on('click', '.delete-prompt', function() {
            scheduleDelorder_week = $(this).attr('id');
            
        });

        $(document).on('click', '#btn_deleteschedule', function() {
            if (scheduleDelorder_week != '') {
                $.ajax
        ({
            url: "/Classes/DeleteSchedule",
            data: { order_week: scheduleDelorder_week },
            contentType: "application/html; charset=utf-8",
            type: "GET",
            cache: !0,
            datatype: "html",
            success: function (result) {

                //---- show success modal
                $('#modal-delete').modal('toggle');
                LoadBarnameHaftegi();

            },
            error: function () {
                //---- show error modal
            }
        })
            }

        });


    });




    function AddNewCol(colNum) {

            var myTable = $('#table-barname-list-eidt');
            var colCount = myTable.find('td[data-row=0]').length;
            var rowCount = $("#table-barname-list-eidt tr").length;
            //incriment id numbers to make room for the new column
            //myTable_IncrimentColIdNumber(colNum, 1);

            //add new column by adding a new cell to each row
            for (row = 0; row < rowCount; row++) {
                //add a new cell after the cell for the previous column

                // inner Html td


                //$('td[data-row=' + row + '][data-col=' + (parseInt(colNum) - 1) + ']').after('<td data-row="' + row + '" data-col="' + colNum + '"> ' + contenttd + '   </td>');
                $('td[data-row=' + row + '][data-col=' + (parseInt(colNum) - 1) + ']').after('<td data-row="' + row + '" data-col="' + colNum + '"></td>');

                

                var courselist = @Html.Raw(Json.Encode(@ViewBag.courselist));
                var teacherlist = @Html.Raw(Json.Encode(@ViewBag.teacherlist));
                var data = {
                    '0': 'کامل', '1': 'چرخشی', '2': 'تک زنگ'
                };


                //----------- scheduleid
                var schedulename="schedule_"+colNum;
                var input_scheduleid=$('<input name="'+schedulename+'" value="'+0+'" type=\"hidden\"  />');
                input_scheduleid.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');
                //----------- course 1
                var div1=$('<div class=\"custome-select\"/>');
                var span1 = $('<span>نام درس اول : </span>');
                span1.appendTo(div1);

                var coursename1="course1_"+colNum;
                var course1 = $('<select name="' + coursename1 + '" />');
                var opcourse1=$('<option />', { value: 0, text: 'انتخاب کنید...'});
                opcourse1.appendTo(course1);
                for(var i = 0; i < courselist.length; i++) {
                    var o = $('<option />', { value: courselist[i].id, text: courselist[i].name});
                    o.appendTo(course1);

                }
                
                course1.appendTo(div1);

                div1.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');


                //------------- teacher 1
                var div2=$('<div class=\"custome-select\"/>');
                var span2 = $('<span>نام مدرس اول : </span>');
                span2.appendTo(div2);

                var teachername1="teacher1_"+colNum;
                var teacher1 = $('<select name="' + teachername1 + '" />');
                var opteacher1=$('<option />', { value: 0, text: 'انتخاب کنید...'});
                opteacher1.appendTo(teacher1);
                for(var i = 0; i < teacherlist.length; i++) {

                    var o = $('<option />', { value: teacherlist[i].username, text: teacherlist[i].firstname+' '+ teacherlist[i].lastname });
                    o.appendTo(teacher1);

                }
                
                teacher1.appendTo(div2);

                div2.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');

                var hr1=$('<hr>');
                hr1.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');
                //---------  course 2
                var coursename2="course2_"+colNum;
                var div3=$('<div id="' + coursename2 + '" class=\"custome-select\" style=\"display:none;\"  />');
                var span3 = $('<span>نام درس دوم : </span>');
                span3.appendTo(div3);
                var course2 = $('<select name="' + coursename2 + '" />');
                var opcourse2=$('<option />', { value: 0, text: 'انتخاب کنید...'});
                opcourse2.appendTo(course2);
                for(var i = 0; i < courselist.length; i++) {
                    var o = $('<option />', { value: courselist[i].id, text: courselist[i].name });
                    o.appendTo(course2);

                }
                
                course2.appendTo(div3);

                div3.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');
                //--------- teacher 2
                var teachername2="teacher2_"+colNum;
                var div4=$('<div id="' + teachername2 + '" class=\"custome-select\" style=\"display:none;\" />');
                var span4 = $('<span>نام مدرس دوم : </span>');
                span4.appendTo(div4);
                var teacher2 = $('<select name="' + teachername2 + '" />');
                var opteacher2=$('<option />', { value: 0, text: 'انتخاب کنید...'});
                opteacher2.appendTo(teacher2);
                for(var i = 0; i < teacherlist.length; i++) {
                    var o = $('<option />', { value: teacherlist[i].username, text: teacherlist[i].firstname+' '+ teacherlist[i].lastname });
                    o.appendTo(teacher2);

                }
                
                teacher2.appendTo(div4);

                div4.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');

                var hr2=$('<hr>');
                hr2.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');
                
                //----------- type ring
                var div5=$('<div class=\"custome-select\"/>');
                var span5 = $('<span>نوع زنگ : </span>');
                span5.appendTo(div5);

                var ringname="ringtype_"+colNum;
                var ringtype = $('<select name="' + ringname + '" class=\"info_ring\"  data-bind="' + colNum + '" />');

                for (var val in data) {
                    $('<option />', { value: val, text: data[val] }).appendTo(ringtype);
                }
                ringtype.appendTo(div5);


                div5.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');

                var hr3=$('<hr>');
                hr3.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');
                //--------- start end date
                var div6=$('<div class=\"custome-select\"/>');
                var startdatename="startdate_"+colNum;
                var input1=$('<input name="' + startdatename + '" type=\"text\" class=\"observer-example date-picker\">');
                input1.appendTo(div6);

                var span6 = $('<span> الی </span>');
                span6.appendTo(div6);

                var enddatename="enddate_"+colNum;
                var input2=$('<input name="' + enddatename + '" type=\"text\" class=\"observer-example date-picker\">');
                input2.appendTo(div6);

                div6.appendTo('td[data-row=' + row + '][data-col=' + colNum + ']');
            }
    }

    
    function AddNewHead(colNum)
    {
        var myTable = $('#table-barname-list-eidt>thead>tr');
        var myth=$('<th  data-col="' + colNum + '" class=\"text-center th-zang-x\"></th>');

        var ringtext=" زنگ "+colNum;
        var ringname="ring"+colNum;
        var span1 = $('<span name="' + ringname+ '" >'+ringtext+' </span>');

        span1.appendTo(myth);
        myth.appendTo(myTable);
    }

    function myTable_DelCol(col) {
        $('td[data-col=' + parseInt(col) + ']').remove();
        $('th[data-col=' + parseInt(col) + ']').remove();
    }

    function LoadBarnameHaftegi() {
        $.ajax
        ({
            url: "/Classes/BarnameHaftegiPartial",
            //data: { page: page },
            contentType: "application/html; charset=utf-8",
            type: "GET",
            cache: !0,
            datatype: "html",
            success: function (result) {
                $("#tbl_scheduleview").html(result);

            },
            error: function () {
                $("#tbl_scheduleview").html("Post Not Found")
            }
        })
    }

</script>

    }