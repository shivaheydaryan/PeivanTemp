@model  IEnumerable<ViewModel.StudentList_VM>
@using PagedList.Mvc;
@{
    ViewBag.Title = "studentlist";
    Layout = "~/Views/Shared/Layout/_SiteManager.cshtml";

}
@{ 
    string Class_Name = "";

    ViewModel.Institute_Info_Session_VM Institute_info_Session = new ViewModel.Institute_Info_Session_VM();
    if (Session["Institute_info"] != null)
    {
        Institute_info_Session = (ViewModel.Institute_Info_Session_VM)Session["Institute_info"];
    }

    ViewModel.ClassInfo_VM class_info = new ViewModel.ClassInfo_VM();
    if (Session["Class_info"] != null)
    {
        class_info = (ViewModel.ClassInfo_VM)Session["Class_info"];
        Class_Name = class_info.Name;
    }


    int Total_item=0, Total_page=0, Current_page=0;
    Total_item = 0;
    if(ViewBag.Total_item!=null)
    {
        Total_item = ViewBag.Total_item;
    }
    if(ViewBag.Total_page!=null)
    { Total_page = ViewBag.Total_page; }
    if(ViewBag.Current_page!=null)
    { Current_page = ViewBag.Current_page + 1; }



    string Name = "";
    if (ViewBag.Name != null)
    {
        Name = (string)ViewBag.Name;
    }

    string CodeMelli = "";
    if (ViewBag.CodeMelli != null)
    {
        CodeMelli = (string)ViewBag.CodeMelli;
    }


    string StudentCode = "";
    if (ViewBag.StudentCode != null)
    {
        StudentCode = (string)ViewBag.StudentCode;
    }






}
<!--Create Page Here and Footer-->
<div id="main-body" class="col-md-10 col-sm-10 col-xs-10 valign-top display-table-row">
    <div id="content">
        <header>
            <h4 class="">لیست دانش آموزان کلاس @Class_Name</h4>
            <hr class="line-under-title" />
        </header>

        <!--Alert Msg-->
        <div class="alert alert-success fade in hidden">
            <a href="#" class="close pull-left" data-dismiss="alert" aria-label="close">&times;</a>
            با موفقیت ثبت گردید!
        </div>

        <!--Search-->
        <div class="row">

            <!--Add Student-->
            <div class="col-md-12">
                <div class="class-action-btn">
                    <a class="btn btn-md btn-default" href="@Url.Action("Create")" role="button">
                        <span class="fas fa-plus-circle" aria-hidden="true"></span>&nbsp;&nbsp;اضافه کردن دانش آموز به کلاس @Class_Name
                    </a>
                </div>
            </div><!--End Add Student-->
            @using (@Html.BeginForm("Student_list", "Student", FormMethod.Post))
            {
                <input name="page" type="hidden" value="@Current_page" />
                <div class="search-top">
                    <h5 class="">برای جستجو یکی از کادرهای زیر را پر کنید:</h5>
                    <div class="col-md-3">
                        <div class="class-action-btn">
                            <button type="submit" class="btn btn-md btn-default">
                                <span class="fas fa-search" aria-hidden="true"></span>&nbsp;&nbsp;جستجو کن
                            </button>
                        </div>

                    </div>
                    <div class="col-md-3">
                        <input name="StudentCode" type="text" class="input-search-code" placeholder="کد دانش آموزی" value="@StudentCode" />
                    </div>
                    <div class="col-md-3">
                        <input name="CodeMelli" type="text" class="input-search-meli" placeholder="کد ملی" value="@CodeMelli" />
                    </div>
                    <div class="col-md-3">
                        <input name="Name" type="text" class="input-search-name" placeholder="نام و نام خانوادگی" value="@Name" />
                    </div>
                    
                    
                </div>
            }
            
        </div>

        <hr class="line-under-title" />

        <!--Table-->
        <div class="table-responsive">
            <table class="table table-striped table-bordered" id="table-student-list-all">
                <thead>
                    <tr>
                        <th class="text-center" id="th-student-row">ردیف</th>
                        <th class="text-center" id="th-student-picture">عکس</th>
                        <th class="text-center" id="th-student-name">نام</th>
                        <th class="text-center" id="th-student-family">نام خانوادگی</th>
                        <th class="text-center" id="th-student-sex">جنسیت</th>
                        <th class="text-center" id="th-student-code">کد دانش آموزی</th>
                        <th class="text-center" id="th-student-meli-code">کد ملی</th>
                        <th class="text-center" id="th-student-dad-name">نام پدر</th>
                        <th class="text-center" id="th-student-dad-name">وضعیت</th>
                        <th class="text-center" id="th-student-action">عملیات</th>
                    </tr>
                </thead>
                <tbody>

                @{
                    int counter = 0;
                }
                    @if (Model != null)
                    {
                        foreach (var item in Model)
                        {
                            counter++;
                            <tr class="student-info">
                                <td class="text-center clickable-row td-student-row ">@counter</td>
                                <td class="text-center td-student-picture"><img src="~/Content/images/User.png" class="img-responsive" alt="user-profile-pic" /></td>
                                <td class="text-center clickable-row td-student-name" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">@item.firstname</td>
                                <td class="text-center clickable-row td-student-family" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">@item.lastname</td>
                                @if (item.gender == true || item.gender == null)
                                {
                                    <td class="text-center clickable-row td-student-sex" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">پسر</td>
                                }
                                else
                                {
                                    <td class="text-center clickable-row td-student-sex" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">دختر</td>
                                }
                                <td class="text-center clickable-row td-student-code" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">@item.Code</td>
                                <td class="text-center clickable-row td-student-meli-code" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">@item.Code_Melli</td>
                                <td class="text-center clickable-row td-student-dad-name" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">@item.Fathername</td>
                                @if (item.Active == null || item.Active == true)
                                {
                                    <td class="text-center clickable-row td-student-dad-name" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">فعال</td>
                                }
                                else
                                {
                                    <td class="text-center clickable-row td-student-dad-name" data-href="@Url.Action("StudentInfo","Student",new { StudentId=item.username})">غیرفعال</td>
                                }


                                <td class="text-center td-student-action">
                                    <a href="@Url.Action("Edit","Student",new { Studentid=item.username})" class="btn btn-default btn-xs"><span class="fas fa-pencil-alt"></span>&nbsp;ویرایش</a>
                                    <a id="@item.username" class="btn btn-danger btn-xs stddel" href="#" data-toggle="modal" data-target="#modal-delete" role="button">
                                        <span class="far fa-trash-alt"></span>&nbsp;حذف
                                    </a>
                                </td>
                            </tr>
                        }
                    }

                   
                </tbody>
            </table><!--End Table-->
        </div>

        <!-- Modal For Delete Student -->
        <div class="modal fade" id="modal-delete" role="dialog">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <!--
                     <div class="modal-header">
                     </div> -->
                    @using (@Html.BeginForm("Delete", "Student", FormMethod.Post))
                    {
                        <div class="modal-body text-center">
                            <h4>آیا مایل به حذف هستید؟</h4>
                        </div>
                        <div class="modal-footer text-center">
                            <div class="col-md-6">
                                <button type="button" class="btn btn-default" data-dismiss="modal">خیر</button>
                            </div>
                            <div class="col-md-6">
                                <input id="Studentiddel" name="Studentid" type="hidden" />
                                <button type="submit" class="btn btn-danger" data-send="modal">بله</button>
                            </div>
                        </div>
                    }
                    

                </div>
            </div>
        </div>
        <!-- End Modal For Delete Student -->

        <hr class="line-under-title" />

        <!--Pagination-->


        <div class="row class-paging">
            <div class="col-md-12 text-center">

                <ul class="pagination d-flex justify-content-center">
                    @if (Model != null)
                    {
                        if (Current_page != 1)
                        {
                            <li><a href="@Url.Action("Student_list", "Student", new { Name = Name, CodeMelli = CodeMelli, StudentCode = StudentCode, page = 1 })">&raquo;</a></li>
                        }

                        for (int i = 1; i <= Total_page; i++)
                        {
                            if (Current_page == i)
                            {
                                <li class="active"><a href="@Url.Action("Student_list", "Student", new { Name = Name, CodeMelli = CodeMelli, StudentCode = StudentCode, page = i })">@i</a></li>
                            }
                            else
                            {
                                <li><a href="@Url.Action("Student_list", "Student", new { Name = Name, CodeMelli = CodeMelli, StudentCode = StudentCode, page = i })">@i</a></li>
                            }
                        }

                        if (Current_page != Total_page)
                        {
                            <li><a href="@Url.Action("Student_list", "Student", new { Name = Name, CodeMelli = CodeMelli, StudentCode = StudentCode, page = Total_page })">&laquo;</a></li>
                            }
                        }
                    
                    

                </ul>

            </div>
        </div> <!--End Pagination-->

    </div><!--End Container-->
    

</div>
<!--End Page Body-->

<script>
    $(document).ready(function (ev) {
        var StdDel;
        $(document).on('click', '.stddel', function () {
            StdDel = $(this).attr('id');
            $("#Studentiddel").val(StdDel);
            
        });

    });
</script>
